---
title: "Get started"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Get started}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  chunk_output_type: console
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

## How to use **meta.arrR**

```{r setup}
library(meta.arrR)

```

### 1. Load parameters

```{r load_parameters}

# get starting values
starting_values <- meta.arrR::meta.arrR_starting_values

# get parameters
parameters <- meta.arrR::meta.arrR_parameters

# set time per iterations
min_per_i <- 120

# run the model for n years
years <- 1
max_i <- (60 * 24 * 365 * years) / min_per_i

# save results only every m days
days <- 5
save_each <- (24 / (min_per_i / 60)) * days

n <- 5

starting_values$pop_n <- rep(x = 5, n = n)

parameters$move_residence <- max_i / (5 * 4)
```

### 2. Setup simulation enviroment

```{r setup_envirnment}
# create 5 reef cells in center of seafloor
reef_matrix <- matrix(data = c(-1, 0, 0, 1, 1, 0, 0, -1, 0, 0), 
                      ncol = 2, byrow = TRUE)

# setup extent and grain
dimensions <- c(100, 100)

grain <- c(1, 1)

stable_vals <- arrR::get_stable_values(starting_values = starting_values,
                                       parameters = parameters)

starting_values$nutrients_pool <- stable_vals$nutrients_pool

starting_values$detritus_pool <- stable_vals$detritus_pool

metasyst <- setup_meta(n = n, max_i = max_i, dimensions = dimensions, grain = grain, 
                       reefs = reef_matrix, starting_values = starting_values, parameters = parameters)

nutr_input <- sim_nutr_input(n = n, max_i = max_i, input_mn = stable_vals$nutrients_pool,
                             freq_mn = 5, variability = 0.1)
```

```{r run_dummy, echo = FALSE}
result <- meta.arrR:::result_readme
```

```{r run_model, eval = FALSE}
result <- run_meta(metasyst = metasyst, nutr_input = nutr_input,
                   parameters = parameters, reef_attraction = TRUE,
                   max_i = max_i, save_each = save_each, min_per_i = min_per_i)
```

### 3. Analyze results

```{r analyze_results, eval = FALSE}
plot(result, what = "seafloor")

plot_local_abund(result)

get_abundance(result)
```
